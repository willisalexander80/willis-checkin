<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WILLIS Daily Check‑in</title>

<!-- ‑‑‑ global/reset + colour / typography ‑‑‑ -->
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Arial,sans-serif;
     background:#f5f6fa;color:#2c3e50;min-height:100vh}
.container{max-width:500px;margin:0 auto;background:#fff;min-height:100vh;
           box-shadow:0 0 20px rgba(0,0,0,.08)}

/* screen‑switcher */
.screen{display:none} .screen.active{display:block}

/* ──────── LOGIN ──────── */
#login-screen .container{display:flex;flex-direction:column;justify-content:center;
                         align-items:center;gap:24px;padding:0 20px;text-align:center}
.scale-strip{display:flex;gap:8px;margin-bottom:32px}
.scale-strip .bar{width:44px;height:12px;border-radius:4px}
.bar.red{background:#e74c3c}.bar.orange{background:#e67e22}
.bar.yellow{background:#f1c40f}.bar.green{background:#27ae60}
#login-screen h1{font-size:32px;font-weight:700}
#login-screen p{font-size:18px;opacity:.85}

.card{max-width:460px;width:90%;display:flex;flex-direction:column;gap:24px}
.card input,.card button{height:56px;width:100%;border-radius:12px;font-size:18px}
.card input{padding:0 16px;border:2px solid #ccc}
.card button{background:#1c90e4;color:#fff;border:none;font-weight:600;cursor:pointer;
             transition:filter .15s}
.card button:active{filter:brightness(.9)}

/* ──────── DASHBOARD ──────── */
.dashboard-header{background:#2c3e50;color:#fff;padding:30px 20px;margin-bottom:30px;position:relative}
.welcome-text{font-size:28px;font-weight:600;margin-bottom:8px}
.dashboard-subtitle{font-size:18px;opacity:.9}
.crew-info{font-size:16px;opacity:.8}
#logout-btn{position:absolute;top:20px;right:20px;padding:8px 14px;background:#fff;
            color:#2c3e50;border:none;border-radius:6px;font-size:14px;cursor:pointer}
.metrics-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;padding:0 20px}
.metric-card{background:#fff;padding:25px;border-radius:16px;text-align:center;
             box-shadow:0 2px 10px rgba(0,0,0,.08)}
.metric-number{font-size:48px;font-weight:700;margin-bottom:8px}
.metric-label{font-size:16px;color:#7f8c8d;font-weight:500}

/* team‑status + performance coloured cards */
.team-status-card .metric-number,.team-status-card .metric-label,
.performance-card .metric-number,.performance-card .metric-label{color:#fff}
.status-green{background:#27ae60!important}.status-yellow{background:#f1c40f!important}
.status-orange{background:#e67e22!important}.status-red{background:#e74c3c!important}
.performance-card.score-1{background:#e74c3c!important}
.performance-card.score-2{background:#e67e22!important}
.performance-card.score-3{background:#f1c40f!important}
.performance-card.score-4{background:#27ae60!important}
.performance-card.score-5{background:#3498db!important}

.check-in-button{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);
                 width:calc(100% - 40px);max-width:460px;padding:16px;background:#3498db;
                 color:#fff;border:none;border-radius:12px;font-size:18px;font-weight:600;
                 cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,.2)}
.check-in-button:active{transform:translateX(-50%) scale(.98);background:#2980b9}

/* ──────── CHECK‑IN form (kept from your style guide) ──────── */
/*  (trimmed for brevity – all original styles preserved) */
.form-section{padding:20px}.metric-group{margin-bottom:30px}
.metric-label{font-size:16px;font-weight:500;color:#495057;margin-bottom:12px;display:block}
.button-scale{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:5px}
.scale-button{height:60px;border:2px solid transparent;border-radius:12px;font-size:14px;
              font-weight:600;color:#fff;cursor:pointer;display:flex;align-items:center;
              justify-content:center;position:relative;text-shadow:0 1px 2px rgba(0,0,0,.2)}
.scale-button:active{transform:scale(.95)}
.scale-button.selected{border-color:#2c3e50;box-shadow:0 0 0 3px rgba(44,62,80,.2)}
.scale-button.selected::after{content:'✓';position:absolute;top:4px;right:4px;font-size:16px}
.scale-1{background:#e74c3c}.scale-2{background:#e67e22}.scale-3{background:#f1c40f}
.scale-4{background:#27ae60}.scale-5{background:#3498db}
/* (all other check‑in styles unchanged – retained from your sheet) */
</style>
</head>

<body>

<!-- ░░ LOGIN ░░ -->
<div id="login-screen" class="screen active">
  <div class="container">
    <div class="scale-strip">
      <span class="bar red"></span><span class="bar orange"></span>
      <span class="bar yellow"></span><span class="bar green"></span>
    </div>

    <h1>Jobsite Daily Check‑in</h1>
    <p>Sign in with your company e‑mail to continue</p>

    <div class="card">
      <input id="email-input" type="email" placeholder="you@company.com" />
      <button onclick="sendMagicLink()">Send magic link</button>
    </div>
  </div>
</div>

<!-- ░░ DASHBOARD ░░ -->
<div id="dashboard-screen" class="screen">
  <div class="container dashboard-container">
      <div class="dashboard-header">
        <h1 class="welcome-text">Welcome back</h1>
        <div class="dashboard-subtitle">Jobsite Dashboard</div>
        <div id="crew-info" class="crew-info">Crew: — | Project: —</div>
        <button id="logout-btn" onclick="logout()">Log out</button>
      </div>

      <div class="metrics-grid">
        <div class="metric-card"><div id="total-checkins" class="metric-number">0</div>
             <div class="metric-label">Total Check‑ins</div></div>

        <div id="team-status-card" class="metric-card team-status-card status-grey">
             <div id="team-status-emoji"  class="team-status-emoji">—</div>
             <div id="team-status-text"   class="team-status-text">No Check‑in</div>
             <div class="metric-label">Today's Team Status</div></div>

        <div class="metric-card"><div id="green-days" class="metric-number">0</div>
             <div class="metric-label">Team Green Days</div></div>

        <div id="performance-card" class="metric-card performance-card score-3">
             <div id="performance-score" class="metric-number">3.0</div>
             <div class="metric-label">Project Performance Score</div></div>
      </div>

      <button class="check-in-button" onclick="showCheckinForm()">Start Daily Check‑in</button>
  </div>
</div>

<!-- ░░ CHECK‑IN FORM ░░ -->
<div id="checkin-screen" class="screen">
  <!-- your full form markup is exactly as you supplied – omitted here for length -->
  <!-- … keep everything from <div class="header"> down to </div class="submit-section"> … -->
</div>

<!-- ░░ SCRIPTS ░░ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ‑‑‑ Initialise Supabase ‑‑‑ */
const SUPABASE_URL = 'https://atmcmhmuxgldajwlwtga.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0bWNtaG11eGdsZGFqd2x3dGdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MjM2NTksImV4cCI6MjA2NzI5OTY1OX0.jH08SM114bibZATgYDPlL1C5mL7-fOjN7rrCBpVExaY';
const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* Handle magic‑link redirect (hash → session) */
(async () => {
  if (location.hash.includes('access_token')) {
    const { error } = await db.auth.getSessionFromUrl({ storeSession:true });
    if (error) alert('Login failed: '+error.message);
  }
})();

/* Send OTP link */
async function sendMagicLink(){
  const email=document.getElementById('email-input').value.trim();
  if(!email){alert('Enter an e‑mail');return;}
  const {error}=await db.auth.signInWithOtp({email});
  if(error){alert(error.message);return;}
  alert('Check your e‑mail for the link');
}

/* Log‑out helper */
async function logout(){await db.auth.signOut();}

/* Toggle screens on auth change */
db.auth.onAuthStateChange(async(_evt,session)=>{
  const logged=!!session?.user;
  document.getElementById('login-screen').classList.toggle('active',!logged);
  document.getElementById('dashboard-screen').classList.toggle('active',logged);
  if(logged){await loadProfile();await refreshDashboard();}
});

/* Load (or create) profile */
async function loadProfile(){
  const {data:{user}}=await db.auth.getUser(); if(!user)return;
  let {data, error}=await db.from('profiles').select('*').eq('id',user.id).single();
  if(error&&error.code==='PGRST116'){
    await db.from('profiles').insert({id:user.id,full_name:user.email});
    data={full_name:user.email};
  }
  if(!data.full_name||data.full_name===user.email){
    const n=prompt('Enter your name'); if(n){
      await db.from('profiles').update({full_name:n}).eq('id',user.id);data.full_name=n;
    }
  }
  document.querySelector('.welcome-text').textContent=`Welcome back, ${data.full_name}`;
  document.getElementById('crew-info').textContent=
        `Crew: ${data.crew??'—'} | Project: ${data.project??'—'}`;
}

/* --------------  DASHBOARD + FORM JS  -------------- */
/*  (all your existing JS: projectScores, dashboardData, updateDashboard,
    selectScale, selectStatus, grabTags, submitCheckin, refreshDashboard, etc.)
    Paste those functions here exactly as they were – nothing removed.         */

</script>
</body>
</html>
